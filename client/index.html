<!doctype html>
<html lang="en" data-theme="tradebikes">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no"
    />
    <title>TradeBikes - Motorcycle Trading Platform</title>
    <meta
      name="description"
      content="A B2B digital platform facilitating real-time trading of used motorcycles between dealerships and traders"
    />

    <!-- PWA tags -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#2c5282" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="TradeBikes" />
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png" />
    <link rel="icon" type="image/svg+xml" href="/icons/icon-512x512.svg" />
    <!-- Error handling script -->
    <script>
      window.addEventListener("error", function (e) {
        console.error("Global error caught:", e.error);
        document.getElementById("error-info").innerHTML =
          "<strong>Error:</strong> " +
          e.message +
          "<br/><pre>" +
          ((e.error && e.error.stack) || "No stack trace") +
          "</pre>";
        document.getElementById("error-info").style.display = "block";
      });
    </script>
    <style>
      #error-info {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #fff0f0;
        color: #ff0000;
        padding: 10px;
        border-bottom: 1px solid #ff0000;
        z-index: 9999;
        overflow: auto;
        max-height: 50vh;
      }
    </style>
    <!-- Global stylesheet -->
    <link rel="stylesheet" href="/style.css" />

    <!-- Inter font (optional but matches the CSS) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="error-info"></div>
    <div id="root"></div>
    
    <!-- Main application script -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Chat widget script (separate file) -->
    <script src="/chat-widget.js"></script>
    
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script
      type="text/javascript"
      src="https://replit.com/public/js/replit-dev-banner.js"
    ></script>
      // Delay the initialization to ensure the React app loads first
      window.addEventListener('load', function() {
        // Give React app a chance to initialize
        setTimeout(function() {
        // Create a chat button with fixed positioning
        const chatButtonContainer = document.createElement('div');
        chatButtonContainer.style.position = 'fixed';
        chatButtonContainer.style.bottom = '20px';
        chatButtonContainer.style.right = '20px';
        chatButtonContainer.style.zIndex = '9999';
        document.body.appendChild(chatButtonContainer);
        
        // Chat button that opens the chat widget
        const chatButton = document.createElement('button');
        chatButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>';
        chatButton.style.width = '50px';
        chatButton.style.height = '50px';
        chatButton.style.borderRadius = '50%';
        chatButton.style.backgroundColor = '#2c5282';
        chatButton.style.color = 'white';
        chatButton.style.border = 'none';
        chatButton.style.display = 'flex';
        chatButton.style.alignItems = 'center';
        chatButton.style.justifyContent = 'center';
        chatButton.style.cursor = 'pointer';
        chatButton.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        chatButtonContainer.appendChild(chatButton);
        
        // Create a chat widget container (initially hidden)
        const chatWidget = document.createElement('div');
        chatWidget.style.position = 'fixed';
        chatWidget.style.bottom = '80px';
        chatWidget.style.right = '20px';
        chatWidget.style.width = '320px';
        chatWidget.style.height = '400px';
        chatWidget.style.backgroundColor = '#fff';
        chatWidget.style.borderRadius = '8px';
        chatWidget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
        chatWidget.style.display = 'none';
        chatWidget.style.flexDirection = 'column';
        chatWidget.style.overflow = 'hidden';
        chatWidget.style.zIndex = '9999';
        chatWidget.style.border = '1px solid #e2e8f0';
        document.body.appendChild(chatWidget);
        
        // Chat header
        const chatHeader = document.createElement('div');
        chatHeader.style.backgroundColor = '#2c5282';
        chatHeader.style.color = 'white';
        chatHeader.style.padding = '10px 15px';
        chatHeader.style.display = 'flex';
        chatHeader.style.justifyContent = 'space-between';
        chatHeader.style.alignItems = 'center';
        chatHeader.innerHTML = '<div style="display: flex; align-items: center;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><span>TradeBikes Support</span></div>';
        chatWidget.appendChild(chatHeader);
        
        // Close button
        const closeButton = document.createElement('button');
        closeButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
        closeButton.style.backgroundColor = 'transparent';
        closeButton.style.border = 'none';
        closeButton.style.color = 'white';
        closeButton.style.cursor = 'pointer';
        chatHeader.appendChild(closeButton);
        
        // Chat messages container
        const chatMessages = document.createElement('div');
        chatMessages.style.flex = '1';
        chatMessages.style.padding = '15px';
        chatMessages.style.overflowY = 'auto';
        chatMessages.style.backgroundColor = '#f8fafc';
        chatWidget.appendChild(chatMessages);
        
        // Bot message
        const botMessage = document.createElement('div');
        botMessage.style.marginBottom = '10px';
        botMessage.style.maxWidth = '80%';
        
        const botMessageContent = document.createElement('div');
        botMessageContent.textContent = "Hello! I'm your TradeBikes assistant. How can I help you with motorcycle trading today?";
        botMessageContent.style.backgroundColor = '#e2e8f0';
        botMessageContent.style.color = '#1a202c';
        botMessageContent.style.padding = '8px 12px';
        botMessageContent.style.borderRadius = '8px';
        botMessageContent.style.display = 'inline-block';
        
        botMessage.appendChild(botMessageContent);
        chatMessages.appendChild(botMessage);
        
        // Input area
        const inputArea = document.createElement('div');
        inputArea.style.borderTop = '1px solid #e2e8f0';
        inputArea.style.padding = '10px';
        inputArea.style.display = 'flex';
        inputArea.style.backgroundColor = 'white';
        chatWidget.appendChild(inputArea);
        
        // Message input
        const messageInput = document.createElement('input');
        messageInput.type = 'text';
        messageInput.placeholder = 'Type your message...';
        messageInput.style.flex = '1';
        messageInput.style.border = '1px solid #e2e8f0';
        messageInput.style.borderRadius = '4px';
        messageInput.style.padding = '8px 12px';
        messageInput.style.marginRight = '8px';
        inputArea.appendChild(messageInput);
        
        // Send button
        const sendButton = document.createElement('button');
        sendButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>';
        sendButton.style.backgroundColor = '#2c5282';
        sendButton.style.color = 'white';
        sendButton.style.border = 'none';
        sendButton.style.borderRadius = '4px';
        sendButton.style.padding = '8px 12px';
        sendButton.style.cursor = 'pointer';
        inputArea.appendChild(sendButton);
        
        // Quick replies area
        const quickReplies = document.createElement('div');
        quickReplies.style.padding = '10px';
        quickReplies.style.borderTop = '1px solid #e2e8f0';
        quickReplies.style.backgroundColor = 'white';
        quickReplies.innerHTML = '<div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">Common Questions:</div>';
        chatWidget.appendChild(quickReplies);
        
        // Add quick reply buttons
        const questions = [
          'How do I list a motorcycle?',
          'How do I place a bid?',
          'What happens after I accept a bid?',
          'How do I arrange collection?',
          'How do I contact another dealer?'
        ];
        
        const quickRepliesContainer = document.createElement('div');
        quickRepliesContainer.style.display = 'flex';
        quickRepliesContainer.style.flexWrap = 'wrap';
        quickRepliesContainer.style.gap = '5px';
        
        questions.forEach(question => {
          const quickReplyBtn = document.createElement('button');
          quickReplyBtn.textContent = question;
          quickReplyBtn.style.backgroundColor = '#f1f5f9';
          quickReplyBtn.style.color = '#334155';
          quickReplyBtn.style.border = 'none';
          quickReplyBtn.style.borderRadius = '9999px';
          quickReplyBtn.style.padding = '6px 10px';
          quickReplyBtn.style.fontSize = '12px';
          quickReplyBtn.style.cursor = 'pointer';
          quickReplyBtn.dataset.question = question;
          quickRepliesContainer.appendChild(quickReplyBtn);
          
          quickReplyBtn.addEventListener('click', function() {
            sendUserMessage(this.dataset.question);
          });
        });
        
        quickReplies.appendChild(quickRepliesContainer);
        
        // Function to add a user message
        function addUserMessage(text) {
          const userMessage = document.createElement('div');
          userMessage.style.marginBottom = '10px';
          userMessage.style.textAlign = 'right';
          
          const userMessageContent = document.createElement('div');
          userMessageContent.textContent = text;
          userMessageContent.style.backgroundColor = '#2c5282';
          userMessageContent.style.color = 'white';
          userMessageContent.style.padding = '8px 12px';
          userMessageContent.style.borderRadius = '8px';
          userMessageContent.style.display = 'inline-block';
          userMessageContent.style.maxWidth = '80%';
          
          userMessage.appendChild(userMessageContent);
          chatMessages.appendChild(userMessage);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Function to add a bot message
        function addBotMessage(text) {
          const botMessage = document.createElement('div');
          botMessage.style.marginBottom = '10px';
          botMessage.style.maxWidth = '80%';
          
          const botMessageContent = document.createElement('div');
          botMessageContent.textContent = text;
          botMessageContent.style.backgroundColor = '#e2e8f0';
          botMessageContent.style.color = '#1a202c';
          botMessageContent.style.padding = '8px 12px';
          botMessageContent.style.borderRadius = '8px';
          botMessageContent.style.display = 'inline-block';
          
          botMessage.appendChild(botMessageContent);
          chatMessages.appendChild(botMessage);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Function to handle user messages and bot responses
        function sendUserMessage(text) {
          if (!text.trim()) return;
          
          addUserMessage(text);
          messageInput.value = '';
          
          // Show typing indicator
          const typingIndicator = document.createElement('div');
          typingIndicator.style.marginBottom = '10px';
          typingIndicator.style.maxWidth = '80%';
          
          const typingContent = document.createElement('div');
          typingContent.style.backgroundColor = '#e2e8f0';
          typingContent.style.padding = '8px 12px';
          typingContent.style.borderRadius = '8px';
          typingContent.style.display = 'inline-block';
          typingContent.innerHTML = '<div style="display: flex; gap: 4px;"><div style="width: 8px; height: 8px; background-color: #94a3b8; border-radius: 50%; animation: bounce 1s infinite;"></div><div style="width: 8px; height: 8px; background-color: #94a3b8; border-radius: 50%; animation: bounce 1s infinite 0.2s;"></div><div style="width: 8px; height: 8px; background-color: #94a3b8; border-radius: 50%; animation: bounce 1s infinite 0.4s;"></div></div>';
          
          typingIndicator.appendChild(typingContent);
          chatMessages.appendChild(typingIndicator);
          
          // Simulate bot thinking and response
          setTimeout(() => {
            chatMessages.removeChild(typingIndicator);
            
            // Simple response logic
            let response = '';
            const lowerText = text.toLowerCase();
            
            if (lowerText.includes('list') || lowerText.includes('sell')) {
              response = 'To list a motorcycle, go to your dashboard and click "List a Bike". Fill in all the required details about your motorcycle and set your reserve price.';
            } else if (lowerText.includes('bid') || lowerText.includes('offer')) {
              response = 'To place a bid, browse active listings and click on a motorcycle you\'re interested in. Enter your bid amount and submit. Remember, the selling dealer won\'t see other bids.';
            } else if (lowerText.includes('accept') || lowerText.includes('winning')) {
              response = 'When you accept a bid, the buyer will be notified. You\'ll then need to confirm collection details through the "Pending Completion" tab.';
            } else if (lowerText.includes('collection') || lowerText.includes('pickup')) {
              response = 'After a bid is accepted, arrange collection details through the messaging system. Once the motorcycle has been collected, mark it as "Collection Confirmed" in the system.';
            } else if (lowerText.includes('contact') || lowerText.includes('message')) {
              response = 'You can contact other dealers through the messaging tab. Select the dealer you want to contact and write your message.';
            } else if (lowerText.includes('hello') || lowerText.includes('hi')) {
              response = 'Hello! How can I help you with TradeBikes today?';
            } else if (lowerText.includes('thank')) {
              response = 'You\'re welcome! Is there anything else I can help you with?';
            } else {
              response = 'I\'m not sure I understand. Could you rephrase your question? Or select from one of the common questions below.';
            }
            
            addBotMessage(response);
          }, 1000);
        }
        
        // Event listeners
        chatButton.addEventListener('click', function() {
          chatWidget.style.display = 'flex';
          chatButton.style.display = 'none';
        });
        
        closeButton.addEventListener('click', function() {
          chatWidget.style.display = 'none';
          chatButton.style.display = 'flex';
        });
        
        sendButton.addEventListener('click', function() {
          sendUserMessage(messageInput.value);
        });
        
        messageInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            sendUserMessage(this.value);
          }
        });
        
        // Add animation style
        const style = document.createElement('style');
        style.textContent = `
          @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
          }
        `;
        document.head.appendChild(style);
      });
    </script>
    
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script
      type="text/javascript"
      src="https://replit.com/public/js/replit-dev-banner.js"
    ></script>
  </body>
</html>
