import{a as G,b as H,u as V,l as W,r as d,d as X,e as v,j as e,C as J,f as U,g as Y,G as Z,h as _,B as r,m as ee,X as se,D as A,n as B,o as D,p as P,q as T,s as q,L as k,t as te,v as ae,w as ie,x as F,y as E,z as le,A as re,T as ne,k as N}from"./index-BpSmGhpl.js";const de=({auctions:O})=>{const{toast:n}=G(),c=H(),{user:o}=V(),[,Q]=W(),[t,x]=d.useState(null),[a,h]=d.useState(null),[$,m]=d.useState(!1),[K,u]=d.useState(!1),[l,b]=d.useState(void 0),[C,S]=d.useState(""),{data:L=[]}=X({queryKey:["/api/dealers"]}),w=O.filter(s=>s.bids&&s.bids.length>0),j=v({mutationFn:async()=>{if(!(!t||!a))return await N("POST",`/api/auctions/${t.id}/accept-bid`,{bidId:a.id})},onSuccess:()=>{c.invalidateQueries({queryKey:["/api/auctions/dealer"]}),c.invalidateQueries({queryKey:["/api/dashboard/stats"]}),c.invalidateQueries({queryKey:["/api/activity"]}),t&&c.invalidateQueries({queryKey:[`/api/auctions/${t.id}`]}),n({title:"Bid Accepted",description:"The bid has been accepted. Arrange collection details."}),m(!1),u(!0),window.location.pathname!=="/dashboard"&&Q("/dashboard")},onError:s=>{n({title:"Error",description:s.message||"Failed to accept bid",variant:"destructive"})}}),p=v({mutationFn:async()=>{if(!t||!a||!l){n({title:"Error",description:"Please select a collection date",variant:"destructive"});return}return await N("POST",`/api/auctions/${t.id}/schedule-collection`,{bidId:a.id,collectionDate:l,notes:C})},onSuccess:()=>{c.invalidateQueries({queryKey:["/api/auctions/dealer"]}),n({title:"Collection Scheduled",description:"Collection details have been sent to the buyer."}),u(!1),g()},onError:s=>{n({title:"Error",description:s.message||"Failed to schedule collection",variant:"destructive"})}}),M=v({mutationFn:async()=>{if(!(!t||!a))return await N("POST",`/api/auctions/${t.id}/reject-bid`,{bidId:a.id})},onSuccess:()=>{c.invalidateQueries({queryKey:["/api/auctions/dealer"]}),n({title:"Bid Rejected",description:"The bid has been rejected."}),g()},onError:s=>{n({title:"Error",description:s.message||"Failed to reject bid",variant:"destructive"})}}),I=(s,i)=>{x(s),h(i),m(!0)},R=(s,i)=>{x(s),h(i),M.mutate()},g=()=>{x(null),h(null),b(void 0),S("")},y=s=>s?E(new Date(s),"dd MMM yyyy"):"N/A",f=s=>{if(o&&o.id===s)return o.companyName||`${o.username}'s Company`;const i=L.find(z=>z.id===s);return i?i.companyName:`Dealer #${s}`};return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(U,{children:e.jsxs(Y,{className:"text-xl font-semibold flex items-center",children:[e.jsx(Z,{className:"mr-2 h-5 w-5 text-primary"}),"Bids Requiring Action"]})}),e.jsx(_,{children:w.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No bids requiring your action at this time."})}):e.jsx("div",{className:"space-y-6",children:w.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium",children:[s.motorcycle.make," ",s.motorcycle.model]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.motorcycle.year," • ",s.motorcycle.mileage," miles"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ending"}),e.jsx("p",{className:"font-medium",children:y(s.endTime)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Latest Bids"}),s.bids.slice(0,3).map(i=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["£",i.amount.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f(i.dealerId)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y(i.createdAt)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{size:"sm",variant:"ghost",className:"text-green-500 hover:text-green-700 hover:bg-green-100",onClick:()=>I(s,i),children:[e.jsx(ee,{className:"mr-1 h-4 w-4"}),"Accept"]}),e.jsxs(r,{size:"sm",variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-100",onClick:()=>R(s,i),children:[e.jsx(se,{className:"mr-1 h-4 w-4"}),"Reject"]})]})]},i.id)),s.bids.length>3&&e.jsxs(r,{variant:"ghost",size:"sm",className:"w-full",children:["View all ",s.bids.length," bids"]})]})]},s.id))})})]}),e.jsx(A,{open:$,onOpenChange:m,children:e.jsxs(B,{children:[e.jsxs(D,{children:[e.jsx(P,{children:"Accept Bid"}),e.jsx(T,{children:"Are you sure you want to accept this bid? This will end the auction and notify the buyer."})]}),t&&a&&e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:[t.motorcycle.make," ",t.motorcycle.model]}),e.jsxs("p",{className:"text-muted-foreground",children:[t.motorcycle.year," • ",t.motorcycle.mileage," miles"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Bid from: ",f(a.dealerId)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:["£",a.amount.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bid amount"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:y(a.createdAt)})]})]})}),e.jsxs(q,{children:[e.jsx(r,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(r,{onClick:()=>j.mutate(),disabled:j.isPending,children:j.isPending?"Accepting...":"Accept Bid"})]})]})}),e.jsx(A,{open:K,onOpenChange:u,children:e.jsxs(B,{className:"sm:max-w-[425px]",children:[e.jsxs(D,{children:[e.jsx(P,{children:"Schedule Collection"}),e.jsx(T,{children:"Set a date for the buyer to collect the motorcycle."})]}),t&&a&&e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:[t.motorcycle.make," ",t.motorcycle.model]}),e.jsxs("p",{className:"text-muted-foreground",children:[t.motorcycle.year," • ",t.motorcycle.mileage," miles"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Buyer: ",f(a.dealerId)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:["£",a.amount.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Accepted bid"})]})]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"collection-date",children:"Collection Date"}),e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(r,{variant:"outline",className:`w-full justify-start text-left ${!l&&"text-muted-foreground"}`,children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),l&&F(l)?E(l,"PPP"):"Select a date"]})}),e.jsx(le,{className:"w-auto p-0",children:e.jsx(re,{mode:"single",selected:l,onSelect:s=>b(s&&F(s)?s:void 0),initialFocus:!0})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"notes",children:"Notes for Buyer"}),e.jsx(ne,{id:"notes",placeholder:"Add any instructions or details for collection",value:C,onChange:s=>S(s.target.value)})]})]}),e.jsxs(q,{children:[e.jsx(r,{variant:"outline",onClick:()=>{g(),u(!1)},children:"Cancel"}),e.jsx(r,{onClick:()=>p.mutate(),disabled:!l||p.isPending,children:p.isPending?"Scheduling...":"Schedule Collection"})]})]})})]})};export{de as default};
